<!DOCTYPE html>
<html>

<head>
  <title>MyTeacher - Profilo</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>

  <script src="script/script_header.js"></script>
  <script src="script/script_ricerca.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>

  <link rel="stylesheet"
    href="https://mdbcdn.b-cdn.net/wp-content/themes/mdbootstrap4/docs-app/css/dist/mdb5/standard/core.min.css">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css"
    integrity="sha256-3sPp8BkKUE7QyPSl6VfBByBroQbKxKG7tsusY2mhbVY=" crossorigin="anonymous" />
  <style>
    .myTeacherlogo {

      font-family: 'Tahoma';
      font-style: normal;
      font-weight: 900;
      font-size: 3rem;
      line-height: 63px;
      /* identical to box height */
      text-align: center;

      color: #F40000;

      -webkit-text-stroke: 1px black;

    }

    .hide_div {
      opacity: 0;
    }

    .show_div {
      opacity: 100;
    }

    body {
      background: #f5f5f5;
      margin-top: 20px;
    }

    /* ===== Career ===== */
    .career-form {
      background-color: #4e63d7;
      border-radius: 5px;
      padding: 0 16px;
    }

    .career-form .form-control {
      background-color: rgba(255, 255, 255, 0.2);
      border: 0;
      padding: 12px 15px;
      color: #fff;
    }

    .career-form .form-control::-webkit-input-placeholder {
      /* Chrome/Opera/Safari */
      color: #fff;
    }

    .career-form .form-control::-moz-placeholder {
      /* Firefox 19+ */
      color: #fff;
    }

    .career-form .form-control:-ms-input-placeholder {
      /* IE 10+ */
      color: #fff;
    }

    .career-form .form-control:-moz-placeholder {
      /* Firefox 18- */
      color: #fff;
    }

    .career-form .custom-select {
      background-color: rgba(255, 255, 255, 0.2);
      border: 0;
      padding: 12px 15px;
      color: #fff;
      width: 100%;
      border-radius: 5px;
      text-align: left;
      height: auto;
      background-image: none;
    }

    .career-form .custom-select:focus {
      -webkit-box-shadow: none;
      box-shadow: none;
    }

    .career-form .select-container {
      position: relative;
    }

    .career-form .select-container:before {
      position: absolute;
      right: 15px;
      top: calc(50% - 14px);
      font-size: 18px;
      color: #ffffff;
      content: '\F2F9';
      font-family: "Material-Design-Iconic-Font";
    }

    .filter-result .job-box {
      -webkit-box-shadow: 0 0 35px 0 rgba(130, 130, 130, 0.2);
      box-shadow: 0 0 35px 0 rgba(130, 130, 130, 0.2);
      border-radius: 10px;
      padding: 10px 35px;
    }

    ul {
      list-style: none;
    }

    .list-disk li {
      list-style: none;
      margin-bottom: 12px;
    }

    .list-disk li:last-child {
      margin-bottom: 0;
    }

    .job-box .img-holder {
      height: 65px;
      width: 65px;
      background-color: #4e63d7;
      background-image: -webkit-gradient(linear, left top, right top, from(rgba(78, 99, 215, 0.9)), to(#5a85dd));
      background-image: linear-gradient(to right, rgba(78, 99, 215, 0.9) 0%, #5a85dd 100%);
      font-family: "Open Sans", sans-serif;
      color: #fff;
      font-size: 22px;
      font-weight: 700;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-pack: center;
      -ms-flex-pack: center;
      justify-content: center;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      border-radius: 65px;
    }

    .career-title {
      background-color: #4e63d7;
      color: #fff;
      padding: 15px;
      text-align: center;
      border-radius: 10px 10px 0 0;
      background-image: -webkit-gradient(linear, left top, right top, from(rgba(78, 99, 215, 0.9)), to(#5a85dd));
      background-image: linear-gradient(to right, rgba(78, 99, 215, 0.9) 0%, #5a85dd 100%);
    }

    .job-overview {
      -webkit-box-shadow: 0 0 35px 0 rgba(130, 130, 130, 0.2);
      box-shadow: 0 0 35px 0 rgba(130, 130, 130, 0.2);
      border-radius: 10px;
    }

    @media (min-width: 992px) {
      .job-overview {
        position: -webkit-sticky;
        position: sticky;
        top: 70px;
      }
    }

    .job-overview .job-detail ul {
      margin-bottom: 28px;
    }

    .job-overview .job-detail ul li {
      opacity: 0.75;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .job-overview .job-detail ul li i {
      font-size: 20px;
      position: relative;
      top: 1px;
    }

    .job-overview .overview-bottom,
    .job-overview .overview-top {
      padding: 35px;
    }

    .job-content ul li {
      font-weight: 600;
      opacity: 0.75;
      border-bottom: 1px solid #ccc;
      padding: 10px 5px;
    }

    @media (min-width: 768px) {
      .job-content ul li {
        border-bottom: 0;
        padding: 0;
      }
    }

    .job-content ul li i {
      font-size: 20px;
      position: relative;
      top: 1px;
    }

    .mb-30 {
      margin-bottom: 30px;
    }

    .image_print {
      max-height: 3.5rem;
      max-width: 3.5rem;
      min-height: 3.5rem;
      min-width: 3.5rem;
    }
  </style>

</head>

<body class="background" onload="startPage()">

  <div w3-include-html="header.html"></div>
  <section id="notLoggedSection">
    <div class="container py-5">
      <h5 class="alert alert-danger d-flex justify-content-center">Accedi per visualizzare il tuo profilo!</h5>
      <p class="d-flex justify-content-center"><button class="btn btn-lg btn-danger" type="button"
          onclick="window.location = 'html_login.html'">Accedi</button></p>
    </div>
  </section>
  <section id="profileSection">
    <div class="container py-3">

      <div class="row">
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <img id="accountImg" src="" alt="avatar" class="rounded-circle img-fluid"
                style="width: 150px; background-color:#adacac">
              <h5 id="accountUsername" class="my-3"></h5>
              <b id="professorAccount" hidden>
                <p class="alert-success d-inline-flex bd-highlight px-2 rounded"><b>Professore</b>
                </p>
              </b>
              <hr>
              <div class="row d-flex justify-content-center">
                <button id="updateProfileBtn" type="button" class="btn btn-danger" style="max-width: 200px;"
                  onclick="showUpdateForm()">Modifica
                  profilo</button>
                <hr style="opacity: 0;">
                <button id="balanceBtn" type="button" class="btn btn-danger" style="max-width: 200px;"
                  onclick="window.location='conto.html'">Il tuo
                  conto</button>
              </div>
            </div>
          </div>
        </div>
        <div id="infoDiv" class="col-lg-8">
          <div class="card mb-4">
            <div class="card-body">
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Nome</p>
                </div>
                <div class="col-sm-9">
                  <p id="accountName" class="text-muted mb-0"></p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Email</p>
                </div>
                <div class="col-sm-9">
                  <p id="accountEmail" class="text-muted mb-0"></p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Telefono</p>
                </div>
                <div class="col-sm-9">
                  <p id="accountPhone" class="text-muted mb-0"></p>
                </div>
              </div>
              <div id="extraProfDiv" hidden>
                <hr>
                <div class="row">
                  <div class="col-sm-3">
                    <p class="mb-0">Materie</p>
                  </div>
                  <div class="col-sm-9">
                    <p id="accountSubjects" class="text-muted mb-0"></p>
                  </div>
                </div>
                <hr>
                <div class="row">
                  <div class="col-sm-3">
                    <p class="mb-0">Argomenti</p>
                  </div>
                  <div class="col-sm-9">
                    <p id="accountTopics" class="text-muted mb-0"></p>
                  </div>
                </div>
                <hr>
                <div class="row">
                  <div class="col-sm-3">
                    <p class="mb-0">Prezzo</p>
                  </div>
                  <div class="col-sm-9">
                    <p id="accountPrice" class="text-muted mb-0"></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--FORM UPDATE PROFILE-->
        <div id="infoDivF" class="col-lg-8" hidden>
          <div class="card mb-2">
            <div class="card-body">
              <div class="row d-flex align-items-center">
                <div class="col-sm-2">
                  <p class="mb-0">Nome</p>
                </div>
                <div class="col-sm-4">
                  <input type="text" id="accountNameF" class="form-control">
                </div>
                <div class="col-sm-2">
                  <p class="mb-0">Cognome</p>
                </div>
                <div class="col-sm-4">
                  <input type="text" id="accountSurnameF" class="form-control">
                </div>
              </div>
              <hr>
              <div class="row d-flex align-items-center">
                <div class="col-sm-3">
                  <p class="mb-0">Email</p>
                </div>
                <div class="col-sm-9">
                  <input type="text" id="accountEmailF" class="form-control">
                </div>
              </div>
              <hr>
              <div class="row d-flex align-items-center">
                <div class="col-sm-3">
                  <p class="mb-0">Telefono</p>
                </div>
                <div class="col-sm-9">
                  <input type="text" id="accountPhoneF" class="form-control">
                </div>
              </div>
              <hr>
              <div id="extraProfDivF" hidden>
                <div class="row d-flex align-items-center">
                  <div class="col-sm-3">
                    <p class="mb-0">Materie</p>
                  </div>
                  <div class="col-sm-9">
                    <input type="text" id="accountSubjectsF" class="form-control">
                  </div>
                </div>
                <hr>
                <div class="row d-flex align-items-center">
                  <div class="col-sm-3">
                    <p class="mb-0">Argomenti</p>
                  </div>
                  <div class="col-sm-9">
                    <input type="text" id="accountTopicsF" class="form-control">
                  </div>
                </div>
                <hr>
                <div class="row d-flex align-items-center">
                  <div class="col-sm-3">
                    <p class="mb-0">Prezzo</p>
                  </div>
                  <div class="col-sm-9">
                    <input type="text" id="accountPriceF" class="form-control">
                  </div>
                </div>
                <hr>
              </div>
              <div class="row d-flex align-items-center justify-content-center">
                <button type="button" id="sendUpdateBtn" class="btn btn-danger" onclick="sendUpdate()">Aggiorna
                  profilo</button>
              </div>
            </div>
          </div>
        </div>
        <!--END FORM-->

      </div>
    </div>
  </section>

  <section id="lectionsProf" hidden>
    <div class="container">
      <div class="row">
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Data</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">
                    <input type="date" id="dateNewLection" name="dateStandard">
                  </p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Inizio</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">
                    <input type="time" id="startNewLection" name="dateStandard">
                  </p>
                </div>
              </div>
              <br>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Fine</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">
                    <input type="time" id="endNewLection" name="dateStandard">
                  </p>
                </div>
              </div>
              <hr>
              <div class="row d-flex justify-content-center">
                <button id="addLectionBtn" type="button" class="btn btn-danger" style="max-width: 200px;"
                  onclick="addLection()">Aggiungi
                  lezione</button>
              </div>
            </div>
          </div>
        </div>
        <div id="printLectionDiv" class="col-lg-8">
          <div class="card mb-4">
            <div id="lectionDiv" class="card-body overflow-scroll" style="max-height: 300px;">
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Error add lection -->
  <div class="container">
    <div class="modal fade" data-bs-backdrop="static" id="errorAddLectionModal" tabindex="-1" role="dialog"
      aria-labelledby="success" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-body d-flex justify-content-center">
            <div id="msgErrorNewLection" class="container alert alert-danger"></div>
          </div>
          <div class="d-flex justify-content-center modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Chiudi</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js"></script>
<script>
  //keep update and saved if the current account logged is a professor or not
  var professor = false;

  /**
   * Print the header.
   * Chek if there is a current logged user.
   * Print the logged version page or not logged version page.
  **/
  function startPage() {
    includeHTML();
    checkLoggedUser();
    let token = getCookie("token");
    var logged = false;
    if (token != undefined) {
      logged = true;
    }

    if (logged) {
      getUserData();
      document.getElementById("profileSection").removeAttribute("hidden");
      document.getElementById("notLoggedSection").setAttribute("hidden", "");
    } else {
      document.getElementById("notLoggedSection").removeAttribute("hidden");
      document.getElementById("profileSection").setAttribute("hidden", "");
    }
  }

  /**
   * Fill the user data section with the user information.
   * Fille the form with the current info of the user.
   * Form initially hidden, will show up if the "Modifica profilo" button will be pressed.
  **/
  function fillUserData(json) {
    name = json.body.nome;
    cognome = json.body.cognome;
    email = json.body.email;
    phone = json.body.phone;
    subjects = json.body.materie;
    topics = json.body.argomenti;
    price = json.body.prezzo;
    username = json.body.username;
    professor = json.body.professore;
    img = "";
    if (json.body.image != undefined) {
      img = "data:image/jpeg;base64," + json.body.image;
    } else {
      img = "media/account_circle_FILL0_wght400_GRAD0_opsz48.png";
    }


    if (professor) {
      document.getElementById("professorAccount").removeAttribute("hidden");
      document.getElementById("extraProfDiv").removeAttribute("hidden");
      document.getElementById("extraProfDivF").removeAttribute("hidden");
      document.getElementById("lectionsProf").removeAttribute("hidden");
      getLections();
    } else {
      document.getElementById("professorAccount").setAttribute("hidden", "");
      document.getElementById("extraProfDiv").setAttribute("hidden", "");
      document.getElementById("extraProfDivF").setAttribute("hidden", "");
      document.getElementById("lectionsProf").setAttribute("hidden", "");
    }

    document.getElementById("accountName").innerHTML = name + " " + cognome;
    document.getElementById("accountEmail").innerHTML = email;
    if (phone == "" || phone == undefined) {
      document.getElementById("accountPhone").innerHTML = "-";
    } else {
      document.getElementById("accountPhone").innerHTML = phone.slice(0, 3) + " " + phone.slice(3);
    }
    if (price == "" || price == undefined) {
      document.getElementById("accountPrice").innerHTML = "- €/h";
    } else {
      document.getElementById("accountPrice").innerHTML = price + " €/h";
    }
    document.getElementById("accountUsername").innerHTML = username;
    document.getElementById("accountImg").setAttribute("src", img);


    printSubjects = "";
    for (var i = 0; i < subjects.length; i++) {
      printSubjects = printSubjects + subjects[i] + ", ";
    }
    printSubjects = printSubjects.slice(0, -2);

    printTopics = "";
    for (var i = 0; i < topics.length; i++) {
      printTopics = printTopics + topics[i] + ", ";
    }
    printTopics = printTopics.slice(0, -2);

    if (printSubjects == "") {
      document.getElementById("accountSubjects").innerHTML = "-";
    } else {
      document.getElementById("accountSubjects").innerHTML = printSubjects;
    }

    if (printTopics == "") {
      document.getElementById("accountTopics").innerHTML = "-";
    } else {
      document.getElementById("accountTopics").innerHTML = printTopics;
    }

    //FILL FORM
    document.getElementById("accountNameF").value = name;
    document.getElementById("accountSurnameF").value = cognome;
    document.getElementById("accountEmailF").value = email;

    if (phone == "" || phone == undefined) {
      document.getElementById("accountPhoneF").value = "";
    } else {
      document.getElementById("accountPhoneF").value = phone.slice(0, 3) + " " + phone.slice(3);
    }
    if (price == "" || price == undefined) {
      document.getElementById("accountPriceF").value = "";
    } else {
      document.getElementById("accountPriceF").value = price;
    }


    printSubjects = "";
    for (var i = 0; i < subjects.length; i++) {
      printSubjects = printSubjects + subjects[i] + ", ";
    }
    printSubjects = printSubjects.slice(0, -2);

    printTopics = "";
    for (var i = 0; i < topics.length; i++) {
      printTopics = printTopics + topics[i] + ", ";
    }
    printTopics = printTopics.slice(0, -2);

    if (printSubjects == "") {
      document.getElementById("accountSubjectsF").value = "";
    } else {
      document.getElementById("accountSubjectsF").value = printSubjects;
    }

    if (printTopics == "") {
      document.getElementById("accountTopicsF").value = "";
    } else {
      document.getElementById("accountTopicsF").value = printTopics;
    }



  }

  /**
   * Get the user data from the DB.
  **/
  function getUserData() {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const usr = urlParams.get('username')

    fetch('../api/v2/users/' + usr)

      .then(r => r.json().then(data => ({ status: r.status, body: data })))
      .then(obj => {


        if (obj.status == 200) {
          fillUserData(obj);
        } else if (obj.status == 400) {
          document.getElementById("msgErrorNewLection").innerHTML = obj.body.message;
          $("#errorAddLectionModal").modal('toggle');
        } else if (obj.status == 500) {
          document.getElementById("msgErrorNewLection").innerHTML = obj.body.message;
          $("#errorAddLectionModal").modal('toggle');
        }
      })
      .catch(error => console.error(error));
  }

  /**
   * Get the not already booked lections of the professor.
  **/
  function getLections() {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const usr = urlParams.get('username')


    fetch('../api/v2/lection/' + usr)

      .then(r => r.json().then(data => ({ status: r.status, body: data })))
      .then(obj => {


        if (obj.status == 200) {
          printLection(obj.body);
        } else if (obj.status == 400) {
          document.getElementById("msgErrorNewLection").innerHTML = obj.body.message;
          $("#errorAddLectionModal").modal('toggle');
        } else if (obj.status == 500) {
          document.getElementById("msgErrorNewLection").innerHTML = obj.body.message;
          $("#errorAddLectionModal").modal('toggle');
        }
      })
      .catch(error => console.error(error));
  }

  /**
   * Print the lections (date and time) of the professor on the lection section.
   * Add a button "Elimina" for each lection.
  **/
  function printLection(aJSON) {
    lectionDiv = document.getElementById("lectionDiv");

    for (let i = 0; i < (aJSON.length - 1); i++) {
      let tmp = aJSON[i];

      let row = document.createElement("div");
      row.setAttribute("class", "row align-items-center");
      let div1 = document.createElement("div");
      div1.setAttribute("class", "col-sm-4");
      let date = document.createElement("p");
      date.setAttribute("class", "mb-0");
      date.innerHTML = " " + (tmp.starts).slice(0, 10) + " ";
      let div2 = document.createElement("div");
      div2.setAttribute("class", "col-sm-4");
      let time = document.createElement("p")
      time.setAttribute("class", "text-muted mb-0");
      time.innerHTML = "   " + (tmp.starts).slice(11, 16) + " - " + (tmp.ends).slice(11, 16);
      let div3 = document.createElement("div");
      div3.setAttribute("class", "col-sm-4 d-flex flex-row-reverse");
      let btn = document.createElement("button");
      btn.setAttribute("class", "btn btn-danger");
      btn.setAttribute("id", "b" + tmp._id);
      btn.setAttribute("onclick", "deleteLection(this.id)")
      btn.innerHTML = "Elimina";

      let booked = document.createElement("p");
      date.setAttribute("class", "mb-0");
      if (tmp.booked) {
          booked.innerText = "PRENOTATA";
      }
      else {
          booked.innerText = "NON PRENOTATA";
      }

      let hr = document.createElement("hr");

      div1.appendChild(date);
      div1.appendChild(booked);
      div2.appendChild(time);
      div3.appendChild(btn);
      row.appendChild(div1);
      row.appendChild(div2);
      row.appendChild(div3);
      lectionDiv.appendChild(row);
      lectionDiv.appendChild(hr);

    }

    let tmp = aJSON[aJSON.length - 1];

    let row = document.createElement("div");
    row.setAttribute("class", "row align-items-center");
    let div1 = document.createElement("div");
    div1.setAttribute("class", "col-sm-4");
    let date = document.createElement("p");
    date.setAttribute("class", "mb-0");
    date.innerHTML = " " + (tmp.starts).slice(0, 10) + " ";
    let div2 = document.createElement("div");
    div2.setAttribute("class", "col-sm-4");
    let time = document.createElement("p")
    time.setAttribute("class", "text-muted mb-0");
    time.innerHTML = "   " + (tmp.starts).slice(11, 16) + " - " + (tmp.ends).slice(11, 16);
    let div3 = document.createElement("div");
    div3.setAttribute("class", "col-sm-4 d-flex flex-row-reverse");
    let btn = document.createElement("button");
    btn.setAttribute("class", "btn btn-danger");
    btn.setAttribute("id", "b" + tmp._id);
    btn.setAttribute("onclick", "deleteLection(this.id)")
    btn.innerHTML = "Elimina";

    let booked = document.createElement("p");
      date.setAttribute("class", "mb-0");
      if (tmp.booked) {
          booked.innerText = "PRENOTATA";
      }
      else {
          booked.innerText = "NON PRENOTATA";
      }

    div1.appendChild(date);
    div1.appendChild(booked);
    div2.appendChild(time);
    div3.appendChild(btn);
    row.appendChild(div1);
    row.appendChild(div2);
    row.appendChild(div3);
    lectionDiv.appendChild(row);

  }

  /**
   * Show up the form to update the user data.
  **/
  function showUpdateForm() {
    document.getElementById("infoDiv").setAttribute("hidden", "");
    document.getElementById("infoDivF").removeAttribute("hidden");
  }

  /**
   * TO BE IMPLEMENTED
   * POST REQUEST TO UPDATE THE PROFILE IN THE DB
  **/
  function sendUpdate() {
    msg = "La funzione di modifica del profilo non è stata attualmente implementata.<br>";
    msg += "Al momento viene mostrato il prototipo del form di update del profilo.<br>";
    msg += "Il bottone 'Aggiorna Profilo' non manda nessun aggiornameto, ma mostra nuovamente i dati già presenti nel DB."
    document.getElementById("msgErrorNewLection").innerHTML = msg;
    $("#errorAddLectionModal").modal('toggle');



    //-----------------------------------------------------------
    document.getElementById("infoDivF").setAttribute("hidden", "");
    document.getElementById("infoDiv").removeAttribute("hidden");
  }

  /**
   * TO BE IMPLEMENTED
   * POST REQUEST TO DELETE A LECTION IN THE DB
  **/
  function deleteLection(btn_id) {

    msg = "La funzione per eliminare una lezione non è stata attualmente implementata.<br>";
    msg += "Al momento viene solo mostrato il prototipo del bottone 'Elimina'.<br>";
    msg += "Cliccando il bottone viene solo recuperato l'id della lezione che si vorrebbe eliminare."
    document.getElementById("msgErrorNewLection").innerHTML = msg;
    $("#errorAddLectionModal").modal('toggle');

    lection_id = btn_id.slice(1);
    //Fetch to send a post request to delete a lection in the DB
  }

  /**
   * Check if all the requested values to add a lection are filled up.
   * Check if the end time is after the start time.
   * Call the function to send the POST request.
  **/
  function addLection() {
    date = document.getElementById("dateNewLection").value;
    start = document.getElementById("startNewLection").value;
    end = document.getElementById("endNewLection").value;

    showModal = false;
    msg = "";

    if (date == "") {
      msg = msg + "Seleziona una data.";
      showModal = true;
    }
    if (start == "") {
      if (msg == "") {
        msg = msg + "Seleziona un orario di inizio.";
      } else {
        msg = msg + "<br>Seleziona un orario di inizio.";
      }
      showModal = true;
    }
    if (end == "") {
      if (msg == "") {
        msg = msg + "Seleziona un orario di fine.";
      } else {
        msg = msg + "<br>Seleziona un orario di fine.";
      }
      showModal = true;
    }
    if (start > end && (start != "") && (end != "")) {
      if (msg == "") {
        msg = msg + "L'orario di fine non può precedere l'orario di inizio.";
      } else {
        msg = msg + "<br>L'orario di fine non può precedere l'orario di inizio.";
      }
      showModal = true;
    }

    if (showModal) {
      document.getElementById("msgErrorNewLection").innerHTML = msg;
      $("#errorAddLectionModal").modal('toggle');
    } else {
      sendJSONaddLection(date, start, end);
    }
  }

  /**
   * Send a POST request to add the new lection.
   * In case of success, call the refreshAddedLection.
  **/
  function sendJSONaddLection(date, start, end) {

    startJSON = date + "T" + start + ":00Z";
    endJSON = date + "T" + end + ":00Z";

    jsonToSend = '{"starts": "' + startJSON + '","ends": "' + endJSON + '"}';

    fetch('../api/v2/lection/add', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: jsonToSend,
    })

      .then(r => r.json().then(data => ({ status: r.status, body: data })))
      .then(obj => {
        if (obj.status == 201) {
          refreshAddedLection();
        } else if (obj.status == 400) {
          document.getElementById("msgErrorNewLection").innerHTML = obj.body.message;
          $("#errorAddLectionModal").modal('toggle');
        } else if (obj.status == 500) {
          document.getElementById("msgErrorNewLection").innerHTML = obj.body.message;
          $("#errorAddLectionModal").modal('toggle');
        }
      })
      .catch(error => console.error(error));
  }

  /**
   * Refresh the lections section so the new one will be shown up.
  **/
  function refreshAddedLection() {
    document.getElementById("lectionDiv").innerHTML = "";
    getLections();
    document.getElementById("dateNewLection").value = "";
    document.getElementById("startNewLection").value = "";
    document.getElementById("endNewLection").value = "";
  }

</script>